# 질문

본인이 주력으로 사용하는 언어에서 자료구조와 관련 된 클래스가 내부적으로 어떻게 동작하는지 한 가지 사례를 정하여 작성해주세요. ex) ArrayList, HashMap 등등

# 답변

js에는 Map이라는 구조가 있다.
기본적으로 object가 가지고 있는 구조에 key값들을 순서대로 관리하기 위해서 만들어진 클래스로,
Map를 쓰면 기존의 object가 가지고 있는 key, value 저장구조를 그대로 쓸 수 있으면서도,
key의 순서를 보장할 수 있다.(추가된 순서대로)

다만 문제는 이 Map이라는 구조가 key의 순서를 보장하기 위해서 해당 순서와 관련된 array를 가지고 있게되면서,
Map이라는 구조는 생성부터 모든 key에 대해서 reference count를 2씩 올리게 되었다.

이 때문에 Map구조는 Map 내부의 key를 제거하더라도 순서를 위한 array에 기록된 key는 남는다던지 하는 문제로,
정상적으로 gc의 대상이 되지 못하는 등의 문제를 겪게 되었고,
결국 위와 같은 원인으로 발생된 메모리 누수로 인하여 Map이 아닌 weakMap를 사용하길 권장하게 되었다.

weakMap의 경우 Map처럼 key의 순서를 보장해주지 못하는 대신,
key로 object만 가질 수 있도록 설계되었고,
object의 경우 reference count가 제거될 경우 함께 gc의 대상이 되기 때문에,
메모리 누수 문제를 방지함과 동시에 key가 된 object가 사라질 경우 함께 제거될 수 있는 구조를 갖추게 되었다.
